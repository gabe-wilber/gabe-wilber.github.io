{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import{TweenMax}from'gsap';import{Object3D,Box3,SpotLight,SpotLightHelper}from'three';import AudioManager from\"../../src/AudioManager\";import ModelLoader from\"../../src/ModelLoader\";import{groundLevel}from\"../GameSettings\";var IS_MUTED=true;var RailRoad=function(_Object3D){_inherits(RailRoad,_Object3D);function RailRoad(heroWidth,onCollide){var _this;_classCallCheck(this,RailRoad);_this=_possibleConstructorReturn(this,_getPrototypeOf(RailRoad).call(this));_this.active=false;_this.top=0.5;_this.getWidth=function(mesh){var box3=new Box3();box3.setFromObject(mesh);return Math.round(box3.max.x-box3.min.x);};_this.setupLight=function(light){light.position.z=-0.5;light.rotation.y=Math.PI;_this.railRoad.add(light);};_this.update=function(dt,player){if(!_this.active){return;}_this.drive({dt:dt,player:player});};_this.drive=function(_ref){var dt=_ref.dt,player=_ref.player;var position=player.position,hitByTrain=player.hitByTrain,moving=player.moving;var _assertThisInitialize=_assertThisInitialized(_this),train=_assertThisInitialize.train;var offset=22*5;train.mesh.position.x+=train.speed;if(train.mesh.position.x>offset&&train.speed>0){train.mesh.position.x=-offset;_this.startRingingLight();AudioManager.playAsync(AudioManager.sounds.train.move['0']);if(train===hitByTrain){player.hitByTrain=null;}}else if(train.mesh.position.x<-offset&&train.speed<0){train.mesh.position.x=offset;_this.startRingingLight();AudioManager.playAsync(AudioManager.sounds.train.move['0']);if(train===hitByTrain){player.hitByTrain=null;}}else if(!moving){_this.trainShouldCheckCollision({player:player});}};_this.trainShouldCheckCollision=function(_ref2){var player=_ref2.player;var _assertThisInitialize2=_assertThisInitialized(_this),train=_assertThisInitialize2.train;if(Math.round(player.position.z)==_this.position.z&&player.isAlive){var mesh=train.mesh,collisionBox=train.collisionBox;if(player.position.x<mesh.position.x+collisionBox&&player.position.x>mesh.position.x-collisionBox){if(player.moving&&Math.abs(player.position.z-Math.round(player.position.z))>0.1){var forward=player.position.z-Math.round(player.position.z)>0;player.position.z=_this.position.z+(forward?0.52:-0.52);TweenLite.to(player.scale,0.3,{y:1.5,z:0.2});TweenMax.to(player.rotation,0.3,{z:Math.random()*Math.PI-Math.PI/2});_this.onCollide(train,'feathers','train');return;}else{player.position.y=groundLevel;TweenMax.to(player.scale,0.3,{y:0.2,x:1.5});TweenMax.to(player.rotation,0.3,{y:Math.random()*Math.PI-Math.PI/2});}_this.onCollide();}}};_this.startRingingLight=function(){_this.lightRinging=true;_this.ringCount=0;_this.ringLight();};_this.ringLight=function(){clearTimeout(_this.timer);if(_this.lightRinging&&_this.ringCount<15){_this.light.visible=false;_this.ringCount+=1;_this.active_light_b.visible=_this.active_light_a.visible;_this.active_light_a.visible=!_this.active_light_a.visible;_this.timer=setTimeout(_this.ringLight,200);}else{_this.lightRinging=false;_this.ringCount=0;_this.light.visible=true;_this.active_light_b.visible=_this.active_light_a.visible=false;}};_this.heroWidth=heroWidth;_this.onCollide=onCollide;var _railroad=ModelLoader._railroad,_trainLight=ModelLoader._trainLight,_train=ModelLoader._train;_this.railRoad=_railroad.getNode();_this.light=_trainLight.getNode('0');_this.active_light_a=_trainLight.getNode('active_0');_this.active_light_b=_trainLight.getNode('active_1');_this._trainMesh=_train.withSize(Math.random()*2+1);var width=_this.getWidth(_this._trainMesh);_this.train={mesh:_this._trainMesh,speed:0.8,width:width,collisionBox:_this.heroWidth/2+width/2-0.1};_this.setupLight(_this.light);_this.setupLight(_this.active_light_a);_this.setupLight(_this.active_light_b);_this.active_light_a.visible=false;_this.active_light_b.visible=false;_this.railRoad.add(_this._trainMesh);_this._trainMesh.position.y=groundLevel;_this._trainMesh.position.z=0.1;_this.add(_this.railRoad);return _this;}return RailRoad;}(Object3D);export{RailRoad as default};","map":{"version":3,"sources":["/Users/gabew/Codelation-Projects/gabe-wilber.github.io/src/Row/RailRoad.js"],"names":["TweenMax","Object3D","Box3","SpotLight","SpotLightHelper","AudioManager","ModelLoader","groundLevel","IS_MUTED","RailRoad","heroWidth","onCollide","active","top","getWidth","mesh","box3","setFromObject","Math","round","max","x","min","setupLight","light","position","z","rotation","y","PI","railRoad","add","update","dt","player","drive","hitByTrain","moving","train","offset","speed","startRingingLight","playAsync","sounds","move","trainShouldCheckCollision","isAlive","collisionBox","abs","forward","TweenLite","to","scale","random","lightRinging","ringCount","ringLight","clearTimeout","timer","visible","active_light_b","active_light_a","setTimeout","_railroad","_trainLight","_train","getNode","_trainMesh","withSize","width"],"mappings":"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","sourcesContent":["import { TweenMax } from 'gsap';\nimport { Object3D, Box3, SpotLight, SpotLightHelper } from 'three';\n\nimport AudioManager from '../../src/AudioManager';\nimport ModelLoader from '../../src/ModelLoader';\nimport { groundLevel } from '../GameSettings';\n\nconst IS_MUTED = true;\nexport default class RailRoad extends Object3D {\n  active = false;\n\n  top = 0.5;\n\n  getWidth = mesh => {\n    let box3 = new Box3();\n    box3.setFromObject(mesh);\n    return Math.round(box3.max.x - box3.min.x);\n  };\n\n  constructor(heroWidth, onCollide) {\n    super();\n    this.heroWidth = heroWidth;\n    this.onCollide = onCollide;\n    const { _railroad, _trainLight, _train } = ModelLoader;\n\n    this.railRoad = _railroad.getNode();\n\n    this.light = _trainLight.getNode('0');\n    this.active_light_a = _trainLight.getNode('active_0');\n    this.active_light_b = _trainLight.getNode('active_1');\n\n    this._trainMesh = _train.withSize(Math.random() * 2 + 1);\n    const width = this.getWidth(this._trainMesh);\n    this.train = {\n      mesh: this._trainMesh,\n      speed: 0.8,\n      width,\n      collisionBox: this.heroWidth / 2 + width / 2 - 0.1,\n    };\n\n    this.setupLight(this.light);\n    this.setupLight(this.active_light_a);\n    this.setupLight(this.active_light_b);\n    this.active_light_a.visible = false;\n    this.active_light_b.visible = false;\n\n    this.railRoad.add(this._trainMesh);\n\n    this._trainMesh.position.y = groundLevel;\n    this._trainMesh.position.z = 0.1;\n\n    this.add(this.railRoad);\n  }\n  setupLight = light => {\n    light.position.z = -0.5;\n    light.rotation.y = Math.PI;\n    // Make train light shine a little red light down\n    // const spotLight = new SpotLight( 0xff0000 );\n    // // spotLight.rotation.x = Math.PI;\n    // spotLight.distance = 1;\n    // spotLight.position.z = -0.5;\n    // spotLight.target.position.z = -1;\n    // spotLight.castShadow = false;\n    // const spotLightHelper = new SpotLightHelper( spotLight );\n\n    // this.railRoad.add( spotLightHelper );\n    // this.railRoad.add( spotLight );\n    // this.railRoad.add( spotLight.target );\n\n    this.railRoad.add(light);\n  };\n\n  update = (dt, player) => {\n    if (!this.active) {\n      return;\n    }\n    this.drive({ dt, player });\n  };\n\n  drive = ({ dt, player }) => {\n    const { position, hitByTrain, moving } = player;\n    const { train } = this;\n    const offset = 22 * 5;\n\n    train.mesh.position.x += train.speed;\n\n    if (train.mesh.position.x > offset && train.speed > 0) {\n      train.mesh.position.x = -offset;\n      this.startRingingLight();\n      AudioManager.playAsync(AudioManager.sounds.train.move['0']);\n      if (train === hitByTrain) {\n        player.hitByTrain = null;\n      }\n    } else if (train.mesh.position.x < -offset && train.speed < 0) {\n      train.mesh.position.x = offset;\n      this.startRingingLight();\n      AudioManager.playAsync(AudioManager.sounds.train.move['0']);\n      if (train === hitByTrain) {\n        player.hitByTrain = null;\n      }\n    } else if (!moving) {\n      this.trainShouldCheckCollision({ player });\n    }\n  };\n\n  trainShouldCheckCollision = ({ player }) => {\n    const { train } = this;\n    if (Math.round(player.position.z) == this.position.z && player.isAlive) {\n      const { mesh, collisionBox } = train;\n\n      if (\n        player.position.x < mesh.position.x + collisionBox &&\n        player.position.x > mesh.position.x - collisionBox\n      ) {\n        if (\n          player.moving &&\n          Math.abs(player.position.z - Math.round(player.position.z)) > 0.1\n        ) {\n          const forward = player.position.z - Math.round(player.position.z) > 0;\n          player.position.z = this.position.z + (forward ? 0.52 : -0.52);\n\n          TweenLite.to(player.scale, 0.3, {\n            y: 1.5,\n            z: 0.2,\n          });\n          TweenMax.to(player.rotation, 0.3, {\n            z: Math.random() * Math.PI - Math.PI / 2,\n          });\n\n          this.onCollide(train, 'feathers', 'train');\n          return;\n        } else {\n          ///Run Over Hero. ///TODO: Add a side collide\n          // this._hero.scale.y = 0.2;\n          // this._hero.scale.x = 1.5;\n          // this._hero.rotation.y = (Math.random() * Math.PI) - Math.PI/2;\n          player.position.y = groundLevel;\n\n          TweenMax.to(player.scale, 0.3, {\n            y: 0.2,\n            x: 1.5,\n          });\n          TweenMax.to(player.rotation, 0.3, {\n            y: Math.random() * Math.PI - Math.PI / 2,\n          });\n        }\n        this.onCollide();\n      }\n    }\n  };\n\n  startRingingLight = () => {\n    this.lightRinging = true;\n    this.ringCount = 0;\n    this.ringLight();\n    //  AudioManager.playAsync(\n    //   AudioManager.sounds.trainAlarm\n    // );\n  };\n\n  ringLight = () => {\n    clearTimeout(this.timer);\n    if (this.lightRinging && this.ringCount < 15) {\n      this.light.visible = false;\n      this.ringCount += 1;\n      this.active_light_b.visible = this.active_light_a.visible;\n      this.active_light_a.visible = !this.active_light_a.visible;\n\n      this.timer = setTimeout(this.ringLight, 200);\n    } else {\n      this.lightRinging = false;\n      this.ringCount = 0;\n      this.light.visible = true;\n      this.active_light_b.visible = this.active_light_a.visible = false;\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}