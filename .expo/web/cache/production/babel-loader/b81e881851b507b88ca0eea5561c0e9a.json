{"ast":null,"code":"import _createClass from\"@babel/runtime/helpers/createClass\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{Group}from'three';import{utils}from'expo-three';import{BASE_ANIMATION_TIME,groundLevel,IDLE_DURING_GAME_PLAY,PLAYER_IDLE_SCALE,startingRow}from\"./GameSettings\";import ModelLoader from\"../src/ModelLoader\";var normalizeAngle=function normalizeAngle(angle){return Math.atan2(Math.sin(angle),Math.cos(angle));};var PlayerScaleAnimation=function(_TimelineMax){_inherits(PlayerScaleAnimation,_TimelineMax);function PlayerScaleAnimation(player){var _this;_classCallCheck(this,PlayerScaleAnimation);_this=_possibleConstructorReturn(this,_getPrototypeOf(PlayerScaleAnimation).call(this));_this.to(player.scale,BASE_ANIMATION_TIME,{x:1,y:1.2,z:1}).to(player.scale,BASE_ANIMATION_TIME,{x:1.0,y:0.8,z:1}).to(player.scale,BASE_ANIMATION_TIME,{x:1,y:1,z:1,ease:Bounce.easeOut});return _this;}return PlayerScaleAnimation;}(TimelineMax);var PlayerIdleAnimation=function(_TimelineMax2){_inherits(PlayerIdleAnimation,_TimelineMax2);function PlayerIdleAnimation(player){var _this2;_classCallCheck(this,PlayerIdleAnimation);_this2=_possibleConstructorReturn(this,_getPrototypeOf(PlayerIdleAnimation).call(this,{repeat:-1}));_this2.to(player.scale,0.3,{y:PLAYER_IDLE_SCALE,ease:Power1.easeIn}).to(player.scale,0.3,{y:1,ease:Power1.easeOut});return _this2;}return PlayerIdleAnimation;}(TimelineMax);var PlayerPositionAnimation=function(_TimelineMax3){_inherits(PlayerPositionAnimation,_TimelineMax3);function PlayerPositionAnimation(player,_ref){var _this3;var targetPosition=_ref.targetPosition,initialPosition=_ref.initialPosition,_onComplete=_ref.onComplete;_classCallCheck(this,PlayerPositionAnimation);_this3=_possibleConstructorReturn(this,_getPrototypeOf(PlayerPositionAnimation).call(this,{onComplete:function onComplete(){return _onComplete();}}));var delta={x:targetPosition.x-initialPosition.x,z:targetPosition.z-initialPosition.z};var inAirPosition={x:initialPosition.x+delta.x*0.75,y:targetPosition.y+0.5,z:initialPosition.z+delta.z*0.75};_this3.to(player.position,BASE_ANIMATION_TIME,_objectSpread({},inAirPosition)).to(player.position,BASE_ANIMATION_TIME,{x:targetPosition.x,y:targetPosition.y,z:targetPosition.z});return _this3;}return PlayerPositionAnimation;}(TimelineMax);var CrossyPlayer=function(_Group){_inherits(CrossyPlayer,_Group);_createClass(CrossyPlayer,[{key:\"setCharacter\",value:function setCharacter(character){if(this._character===character)return;this._character=character;var node=ModelLoader._hero.getNode(character);if(!node)throw new Error(\"Failed to get node for character: \"+character);if(this.node){this.remove(this.node);}utils.scaleLongestSideToSize(node,1);utils.alignMesh(node,{x:0.5,z:0.5,y:1.0});this.node=node;this.add(node);}}]);function CrossyPlayer(character){var _this4;_classCallCheck(this,CrossyPlayer);_this4=_possibleConstructorReturn(this,_getPrototypeOf(CrossyPlayer).call(this));_this4.animations=[];_this4.hitBy=null;_this4.moving=false;_this4.setCharacter(character);_this4.reset();return _this4;}_createClass(CrossyPlayer,[{key:\"moveOnEntity\",value:function moveOnEntity(){if(!this.ridingOn){return;}this.position.x+=this.ridingOn.speed;this.initialPosition.x=this.position.x;}},{key:\"moveOnCar\",value:function moveOnCar(){if(!this.hitBy){return;}var target=this.hitBy.mesh.position.x;this.position.x+=this.hitBy.speed;if(this.initialPosition)this.initialPosition.x=target;}},{key:\"stopAnimations\",value:function stopAnimations(){this.animations.map(function(val){if(val.pause){val.pause();}val=null;});this.animations=[];}},{key:\"reset\",value:function reset(){this.position.set(0,groundLevel,startingRow);this.scale.set(1,1,1);this.rotation.set(0,Math.PI,0);this.initialPosition=null;this.targetPosition=null;this.moving=false;this.hitBy=null;this.ridingOn=null;this.ridingOnOffset=null;this.isAlive=true;}},{key:\"skipPendingMovement\",value:function skipPendingMovement(){if(!this.moving){return;}this.position.set(this.targetPosition.x,this.targetPosition.y,this.targetPosition.z);if(this.targetRotation){this.rotation.y=normalizeAngle(this.targetRotation);}}},{key:\"finishedMovingAnimation\",value:function finishedMovingAnimation(){this.moving=false;if(IDLE_DURING_GAME_PLAY){if(this.idleAnimation){this.idleAnimation.play();}else{this.idle();}}this.lastPosition=this.position;}},{key:\"stopIdle\",value:function stopIdle(){if(this.idleAnimation&&this.idleAnimation.pause){this.idleAnimation.pause();}this.idleAnimation=null;this.scale.set(1,1,1);}},{key:\"idle\",value:function idle(){if(this.idleAnimation){return;}this.stopIdle();this.idleAnimation=new PlayerIdleAnimation(this);}},{key:\"createPositionAnimation\",value:function createPositionAnimation(_ref2){var _this5=this;var _onComplete2=_ref2.onComplete;return new PlayerPositionAnimation(this,{onComplete:function onComplete(){_this5.finishedMovingAnimation();_onComplete2();},targetPosition:this.targetPosition,initialPosition:this.initialPosition});}},{key:\"commitMovementAnimations\",value:function commitMovementAnimations(_ref3){var _this6=this;var onComplete=_ref3.onComplete;var positionChangeAnimation=this.createPositionAnimation({onComplete:onComplete});this.animations=[positionChangeAnimation,new PlayerScaleAnimation(this),TweenMax.to(this.rotation,BASE_ANIMATION_TIME,{y:this.targetRotation,ease:Power1.easeInOut,onComplete:function onComplete(){return _this6.rotation.y=normalizeAngle(_this6.rotation.y);}})];this.initialPosition=this.targetPosition;}},{key:\"runPosieAnimation\",value:function runPosieAnimation(){this.stopIdle();TweenMax.to(this.scale,0.2,{x:1.2,y:0.75,z:1});}},{key:\"collideWithCar\",value:function collideWithCar(road,car){if(this.moving&&Math.abs(this.position.z-Math.round(this.position.z))>0.1){this.getHitByCar(road,car);}else{this.getRunOverByCar(road,car);}}},{key:\"getRunOverByCar\",value:function getRunOverByCar(road,car){this.position.y=road.top-0.05;TweenLite.to(this.scale,0.2,{y:0.05,x:1.7,z:1.7});TweenMax.to(this.rotation,0.2,{y:Math.random()*Math.PI-Math.PI/2});}},{key:\"getHitByCar\",value:function getHitByCar(road,car){this.hitBy=car;var forward=this.position.z-Math.round(this.position.z)>0;this.position.z=road.position.z+(forward?0.52:-0.52);TweenLite.to(this.scale,0.15,{y:1.5,z:0.2});TweenMax.to(this.rotation,0.15,{z:Math.random()*Math.PI-Math.PI/2});}}]);return CrossyPlayer;}(Group);export{CrossyPlayer as default};","map":{"version":3,"sources":["/Users/gabew/Codelation-Projects/gabe-wilber.github.io/src/CrossyPlayer.js"],"names":["Group","utils","BASE_ANIMATION_TIME","groundLevel","IDLE_DURING_GAME_PLAY","PLAYER_IDLE_SCALE","startingRow","ModelLoader","normalizeAngle","angle","Math","atan2","sin","cos","PlayerScaleAnimation","player","to","scale","x","y","z","ease","Bounce","easeOut","TimelineMax","PlayerIdleAnimation","repeat","Power1","easeIn","PlayerPositionAnimation","targetPosition","initialPosition","onComplete","delta","inAirPosition","position","CrossyPlayer","character","_character","node","_hero","getNode","Error","remove","scaleLongestSideToSize","alignMesh","add","animations","hitBy","moving","setCharacter","reset","ridingOn","speed","target","mesh","map","val","pause","set","rotation","PI","ridingOnOffset","isAlive","targetRotation","idleAnimation","play","idle","lastPosition","stopIdle","finishedMovingAnimation","positionChangeAnimation","createPositionAnimation","TweenMax","easeInOut","road","car","abs","round","getHitByCar","getRunOverByCar","top","TweenLite","random","forward"],"mappings":"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","sourcesContent":["import { Group } from 'three';\nimport { utils } from 'expo-three';\nimport { BASE_ANIMATION_TIME, groundLevel, IDLE_DURING_GAME_PLAY, PLAYER_IDLE_SCALE, startingRow } from './GameSettings';\nimport ModelLoader from '../src/ModelLoader';\n\nconst normalizeAngle = angle => {\n  return Math.atan2(Math.sin(angle), Math.cos(angle));\n};\n\nclass PlayerScaleAnimation extends TimelineMax {\n  constructor(player) {\n    super();\n\n    this.to(player.scale, BASE_ANIMATION_TIME, {\n      x: 1,\n      y: 1.2,\n      z: 1,\n    })\n      .to(player.scale, BASE_ANIMATION_TIME, {\n        x: 1.0,\n        y: 0.8,\n        z: 1,\n      })\n      .to(player.scale, BASE_ANIMATION_TIME, {\n        x: 1,\n        y: 1,\n        z: 1,\n        ease: Bounce.easeOut,\n      });\n  }\n}\n\nclass PlayerIdleAnimation extends TimelineMax {\n  constructor(player) {\n    super({ repeat: -1 });\n\n    this.to(player.scale, 0.3, {\n      y: PLAYER_IDLE_SCALE,\n      ease: Power1.easeIn,\n    }).to(player.scale, 0.3, { y: 1, ease: Power1.easeOut });\n  }\n}\n\nclass PlayerPositionAnimation extends TimelineMax {\n  constructor(player, { targetPosition, initialPosition, onComplete }) {\n    super({\n      onComplete: () => onComplete(),\n    });\n\n    const delta = {\n      x: targetPosition.x - initialPosition.x,\n      z: targetPosition.z - initialPosition.z,\n    };\n\n    const inAirPosition = {\n      x: initialPosition.x + delta.x * 0.75,\n      y: targetPosition.y + 0.5,\n      z: initialPosition.z + delta.z * 0.75,\n    };\n\n    this.to(player.position, BASE_ANIMATION_TIME, { ...inAirPosition }).to(\n      player.position,\n      BASE_ANIMATION_TIME,\n      {\n        x: targetPosition.x,\n        y: targetPosition.y,\n        z: targetPosition.z,\n      },\n    );\n  }\n}\n\nexport default class CrossyPlayer extends Group {\n  animations = [];\n\n  _character;\n\n  setCharacter(character) {\n    if (this._character === character) return;\n    this._character = character;\n    const node = ModelLoader._hero.getNode(character);\n    if (!node) throw new Error(`Failed to get node for character: ${character}`);\n    if (this.node) {\n      this.remove(this.node);\n    }\n\n    utils.scaleLongestSideToSize(node, 1);\n    utils.alignMesh(node, { x: 0.5, z: 0.5, y: 1.0})\n    this.node = node;\n    this.add(node);\n  }\n\n  constructor(character) {\n    super();\n    this.setCharacter(character);\n    this.reset();\n  }\n\n  moveOnEntity() {\n    if (!this.ridingOn) {\n      return;\n    }\n\n    // let target = this._hero.ridingOn.mesh.position.x + this._hero.ridingOnOffset;\n    this.position.x += this.ridingOn.speed;\n    this.initialPosition.x = this.position.x;\n  }\n\n  moveOnCar() {\n    if (!this.hitBy) {\n      return;\n    }\n\n    let target = this.hitBy.mesh.position.x;\n    this.position.x += this.hitBy.speed;\n    if (this.initialPosition) this.initialPosition.x = target;\n  }\n\n  stopAnimations() {\n    this.animations.map(val => {\n      if (val.pause) {\n        val.pause();\n      }\n      val = null;\n    });\n    this.animations = [];\n  }\n\n  reset() {\n    this.position.set(0, groundLevel, startingRow);\n    this.scale.set(1, 1, 1);\n    this.rotation.set(0, Math.PI, 0);\n\n    this.initialPosition = null;\n    this.targetPosition = null;\n    this.moving = false;\n    this.hitBy = null;\n    this.ridingOn = null;\n    this.ridingOnOffset = null;\n    this.isAlive = true;\n  }\n\n  skipPendingMovement() {\n    if (!this.moving) {\n      return;\n    }\n    this.position.set(\n      this.targetPosition.x,\n      this.targetPosition.y,\n      this.targetPosition.z,\n    );\n    if (this.targetRotation) {\n      this.rotation.y = normalizeAngle(this.targetRotation);\n    }\n    // return\n  }\n\n  finishedMovingAnimation() {\n    this.moving = false;\n    if (IDLE_DURING_GAME_PLAY) {\n      if (this.idleAnimation) {\n        this.idleAnimation.play();\n      } else {\n        this.idle();\n      }\n    }\n    this.lastPosition = this.position;\n\n    // this._hero.position.set(Math.round(this._hero.position.x), this._hero.position.y, Math.round(this._hero.position.z))\n  }\n\n  stopIdle() {\n    if (this.idleAnimation && this.idleAnimation.pause) {\n      this.idleAnimation.pause();\n    }\n    this.idleAnimation = null;\n    this.scale.set(1, 1, 1);\n  }\n\n  idle() {\n    if (this.idleAnimation) {\n      return;\n    }\n    this.stopIdle();\n\n    this.idleAnimation = new PlayerIdleAnimation(this);\n  }\n\n  createPositionAnimation({ onComplete }) {\n    return new PlayerPositionAnimation(this, {\n      onComplete: () => {\n        this.finishedMovingAnimation();\n        onComplete();\n      },\n      targetPosition: this.targetPosition,\n      initialPosition: this.initialPosition,\n    });\n  }\n\n  commitMovementAnimations({ onComplete }) {\n    const positionChangeAnimation = this.createPositionAnimation({\n      onComplete,\n    });\n\n    this.animations = [\n      positionChangeAnimation,\n      new PlayerScaleAnimation(this),\n      TweenMax.to(this.rotation, BASE_ANIMATION_TIME, {\n        y: this.targetRotation,\n        ease: Power1.easeInOut,\n        // Reset angle when finished\n        onComplete: () => (this.rotation.y = normalizeAngle(this.rotation.y)),\n      }),\n    ];\n\n    this.initialPosition = this.targetPosition;\n  }\n\n  runPosieAnimation() {\n    this.stopIdle();\n\n    TweenMax.to(this.scale, 0.2, {\n      x: 1.2,\n      y: 0.75,\n      z: 1,\n      // ease: Bounce.easeOut,\n    });\n  }\n\n  hitBy = null;\n  moving = false;\n\n  collideWithCar(road, car) {\n    if (\n      this.moving &&\n      Math.abs(this.position.z - Math.round(this.position.z)) > 0.1\n    ) {\n      this.getHitByCar(road, car);\n    } else {\n      this.getRunOverByCar(road, car);\n    }\n  }\n\n  getRunOverByCar(road, car) {\n\n    this.position.y = (road.top - 0.05);\n\n    TweenLite.to(this.scale, 0.2, {\n      y: 0.05,\n      x: 1.7,\n      z: 1.7,\n    });\n    TweenMax.to(this.rotation, 0.2, {\n      y: Math.random() * Math.PI - Math.PI / 2,\n    });\n  }\n\n  getHitByCar(road, car) {\n    this.hitBy = car;\n\n    const forward = this.position.z - Math.round(this.position.z) > 0;\n    this.position.z = road.position.z + (forward ? 0.52 : -0.52);\n\n    TweenLite.to(this.scale, 0.15, {\n      y: 1.5,\n      z: 0.2,\n    });\n    TweenMax.to(this.rotation, 0.15, {\n      z: Math.random() * Math.PI - Math.PI / 2,\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}